<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GMMCO CI Sales Dashboard - Region Details</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header style="display: flex; align-items: center; justify-content: space-between; padding: 10px 30px; border-bottom: 1px solid #ddd; background-color: #fff;">
  <!-- Left: Logo -->
  <div style="flex: 1;">
    <img src="images/gmmco-logo.png" alt="GMMCO Logo" style="height: 50px;">
  </div>
  <!-- Center: Title -->
  <div style="flex: 2; text-align: center;">
    <h1 style="margin: 0; font-size: 26px; font-weight: bold; color: #1f2937;">
      GMMCO CI Sales Dashboard - Region Details
    </h1>
  </div>
  <!-- Right: Empty to balance layout -->
  <div style="flex: 1;"></div>
</header>
<hr>
  <main>
    <div class="region-title">
      <h2 id="region-title">Region Details - </h2>
      <a href="index.html" class="back-link">⬅ Back to Dashboard</a>
    </div>
    <table id="region-details-table">
      <thead>
        <tr>
          <th>SL.NO</th>
          <th>Customer</th>
          <th>Invoice Date</th>
          <th>Model</th>
          <th>Asset ID</th>
          <th>Serial Number</th>
        </tr>
      </thead>
      <tbody id="region-details-body">
      <tr><td colspan="6">Loading data...</td></tr>
      </tbody>
    </table>
  </main>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const urlParams = new URLSearchParams(window.location.search);
      const region = urlParams.get("region");
      document.getElementById("region-title").textContent = `Region Details - ${region}`;
      try {
        const response = await fetch("http://localhost:3000/get-asset-report");
        if (!response.ok) throw new Error("Failed to fetch data");
        const data = await response.json();
        const sbuMapping = {
          AP: "East", CG: "East", TS: "East",
          DL: "North", MP: "North",
          KA: "South", KL: "South", TN: "South",
          GA: "West", GJ: "West", MH:"West"
        };
        const filtered = data.filter(item => {
          let sbu = item.SBU?.trim();
          if (!sbu) {
            const prefix = item.Plant_Code?.substring(0, 2).toUpperCase();
            sbu = sbuMapping[prefix] || "Unknown";
          }
          return sbu === region;
        });
        const tbody = document.getElementById("region-details-body");
        tbody.innerHTML = filtered.length
          ? filtered.map((item, idx) => `
            <tr>
              <td>${idx + 1}</td>
              <td>${item["Organisation Name"] || "--"}</td>
              <td>${item["Date Purchased"] || "--"}</td>
              <td>${item.Name || "--"}</td>
              <td>${item["Asset ID"] || "--"}</td>
              <td>${item["Serial Number"] || "--"}</td>
            </tr>
          `).join("")
          : `<tr><td colspan="6" style="text-align:center;">No records found for ${region}</td></tr>`;
      } catch (error) {
        console.error("Failed to load region details:", error);
        document.getElementById("region-details-body").innerHTML =
          `<tr><td colspan="6" style="color:red;">❌ Error loading data</td></tr>`;
      }
    });
  </script>
</body>
</html>
